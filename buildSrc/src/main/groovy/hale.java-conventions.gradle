/*
 * A library part of hale-core.
 */

plugins {
  id 'java'
  id 'maven-publish'

  id 'com.diffplug.spotless'

  id 'io.qameta.allure-adapter'

  id 'hale.common'
}

spotless {
  java {
    importOrder('java', 'javax', 'org', 'com', '')

    removeUnusedImports()

    // https://github.com/diffplug/spotless/tree/main/plugin-gradle#eclipse-jdt
    eclipse().configFile(rootProject.file('eclipse-format.xml'))

    if (HaleBuild.useDefaultHeader(project)) {
      licenseHeader(HaleBuild.LICENSE_HEADER_DEFAULT)
    }

    trimTrailingWhitespace()
    endWithNewline()
  }
}

java {
  toolchain {
    languageVersion = JavaLanguageVersion.of(17)
  }
}

dependencies {
  testRuntimeOnly libs.logback.core
  testRuntimeOnly libs.logback.classic
  testRuntimeOnly project(':common:plugins:eu.esdihumboldt.hale.common.logback.config.test')

  // make offline resources available to all tests
  testRuntimeOnly project(':util:features:eu.esdihumboldt.util.feature.resource')
}

task sourcesJar(type: Jar) {
  from sourceSets.main.allJava
  archiveClassifier = 'sources'
}

/*
task javadocJar(type: Jar) {
  from javadoc
  archiveClassifier = 'javadoc'
}
*/

/*
 * Publishing to Maven
 *
 * https://docs.gradle.org/current/userguide/publishing_maven.html
 */
publishing {
  publications {
    library(MavenPublication) {
      from components.java
      artifact sourcesJar
      // artifact javadocJar
    }
  }

  repositories {
    maven {
      url 'https://artifactory.wetransform.to/artifactory/' +
        (version.endsWith('-SNAPSHOT') ? 'libs-snapshot-local' : 'libs-release-local')
      credentials {
        username project.hasProperty('wetfArtifactoryUser') ? wetfArtifactoryUser : ''
        password project.hasProperty('wetfArtifactoryPassword') ? wetfArtifactoryPassword : ''
      }
    }
  }
}
